!function(t){function e(e){"use strict";var o=this;return this.events={},this.state=null,this.options=e||{},this.options.env=this.options.env||(0===Object.keys(t).length&&process&&process.browser!==!0?"server":"client"),this.options.mode=this.options.mode||("server"!==this.options.env&&this.options.pushState&&t.history&&t.history.pushState?"pushState":"hashchange"),this.version="0.6.3","function"==typeof t.addEventListener&&(t.addEventListener("hashchange",function(){o.trigger("hashchange")}),t.addEventListener("popstate",function(t){return(!o.state||null!==o.state.previousState)&&void o.trigger("navigate")})),this}function o(t,e){this.stack=o.global.slice(0),this.router=t,this.runCallback=!0,this.callbackRan=!1,this.propagateEvent=!0,this.value=t.path();for(var n in e)this[n]=e[n];return this}function n(t){this.route=t,this.keys=[],this.regex=e.regexRoute(t,this.keys)}e.regexRoute=function(t,e,o,n){return t instanceof RegExp?t:(t instanceof Array&&(t="("+t.join("|")+")"),t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,o,n,r,a,i){return e.push({name:r,optional:!!i}),o=o||"",""+(i?"":o)+"(?:"+(i?o:"")+(n||"")+(a||n&&"([^/.]+?)"||"([^/]+?)")+")"+(i||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",o?"":"i"))},e._forEach=function(t,e){return"function"==typeof Array.prototype.forEach?Array.prototype.forEach.call(t,e):function(t,e){for(var o=0,n=this.length;n>o;++o)t.call(e,this[o],o,this)}.call(t,e)},e.prototype.get=e.prototype.add=function(t){var e=this,r=Array.prototype.slice.call(arguments,1,-1),a=Array.prototype.slice.call(arguments,-1)[0],i=new n(t),s=function(){var n=i.parse(e.path());if(n.match){var s={route:t,params:n.params,req:n,regex:n.match},p=new o(e,s).enqueue(r.concat(a));if(e.trigger("match",p,n),!p.runCallback)return e;if(p.previousState=e.state,e.state=p,p.parent()&&p.parent().propagateEvent===!1)return p.propagateEvent=!1,e;p.callback()}return e},p="pushState"!==e.options.mode&&"server"!==e.options.env?"hashchange":"navigate";return s().on(p,s)},e.prototype.trigger=function(t){var o=this,n=Array.prototype.slice.call(arguments,1);return this.events[t]&&e._forEach(this.events[t],function(t){t.apply(o,n)}),this},e.prototype.on=e.prototype.bind=function(t,o){var n=this,r=t.split(" ");return e._forEach(r,function(t){n.events[t]?n.events[t].push(o):n.events[t]=[o]}),this},e.prototype.once=function(t,e){var o=!1;return this.on(t,function(){return!o&&(o=!0,e.apply(this,arguments),e=null,!0)})},e.prototype.context=function(t){var e=this,o=Array.prototype.slice.call(arguments,1);return function(){var n=arguments[0],r=arguments.length>2?Array.prototype.slice.call(arguments,1,-1):[],a=Array.prototype.slice.call(arguments,-1)[0],i="/"!==t.slice(-1)&&"/"!==n&&""!==n?t+"/":t,s="/"!==n.substr(0,1)?n:n.substr(1),p=i+s;return e.add.apply(e,[p].concat(o).concat(r).concat([a]))}},e.prototype.navigate=function(t){return this.path(t).trigger("navigate")},e.prototype.path=function(e){var o,n=this;return"string"==typeof e?("pushState"===n.options.mode?(o=n.options.root?n.options.root+e:e,t.history.pushState({},null,o)):t.location?t.location.hash=(n.options.hashBang?"!":"")+e:t._pathname=e||"",this):"undefined"==typeof e?o="pushState"===n.options.mode?t.location.pathname.replace(n.options.root,""):"pushState"!==n.options.mode&&t.location?t.location.hash?t.location.hash.split(n.options.hashBang?"#!":"#")[1]:"":t._pathname||"":e===!1?("pushState"===n.options.mode?t.history.pushState({},null,n.options.root||"/"):t.location&&(t.location.hash=n.options.hashBang?"!":""),n):void 0},e.listen=function(){var t,o;return arguments[0]&&arguments[1]?(t=arguments[0],o=arguments[1]):o=arguments[0],function(){for(var t in o)this.add.call(this,t,o[t]);return this}.call(new e(t||{}))},o.global=[],o.prototype.preventDefault=function(){this.runCallback=!1},o.prototype.stopPropagation=function(){this.propagateEvent=!1},o.prototype.parent=function(){var t=!(!this.previousState||!this.previousState.value||this.previousState.value!=this.value);return!!t&&this.previousState},o.prototype.callback=function(){this.callbackRan=!0,this.timeStamp=Date.now(),this.next()},o.prototype.enqueue=function(t,e){for(var o=Array.isArray(t)?e<t.length?t.reverse():t:[t];o.length;)this.stack.splice(e||this.stack.length+1,0,o.shift());return this},o.prototype.next=function(){var t=this;return this.stack.shift().call(this.router,this.req,this,function(){t.next.call(t)})},n.prototype.parse=function(t){var o=t.match(this.regex),n=this,r={params:{},keys:this.keys,matches:(o||[]).slice(1),match:o};return e._forEach(r.matches,function(t,e){var o=n.keys[e]&&n.keys[e].name?n.keys[e].name:e;r.params[o]=t?decodeURIComponent(t):void 0}),r},e.CallStack=o,e.Request=n,"function"!=typeof t.define||t.define.amd.grapnel?"object"==typeof module&&"object"==typeof module.exports?module.exports=exports=e:t.Grapnel=e:t.define(function(o,n,r){return t.define.amd.grapnel=!0,e})}.call({},"object"==typeof window?window:this);